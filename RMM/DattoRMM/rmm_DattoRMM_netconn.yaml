id: 41a9931d-8cb4-44dc-9c8d-f915dd15dfd8
name: Remote Management and Monitoring tool - DattoRMM - Network Connection
description: |
    Remote Monitoring and Management (RMM) software programs and services are often used by Enterprise and SMB IT to provide management and monitoring of remote endpoints.
    Attackers have also begun to abuse these programs and services as means to maintain persistance or provide fall back command and control channels. A number of threat groups with varied and diverse goals, have been observed using RMM products to achieve missons of espionage, data theft, and ransomware.
    https://github.com/jischell-msft/RemoteManagementMonitoringTools
requiredDataConnectors:
    - connectorId: MicrosoftThreatProtection
    dataTypes:
        - DeviceNetworkEvents
tactics: CommandAndControl
relevantTechniques: T1219
query: |
  let Time_start = now(-5d);
  let Time_end = now();
  //
  DeviceNetworkEvents
  | where Timestamp between (Time_start..Time_end)
  | where RemoteUrl has_any (
          'rmm.datto.com',
          'agent.centrastage.net',
          'audit.centrastage.net',
          'monitoring.centrastage.net',
          'agent-notifications.centrastage.net',
          'agent-comms.centrastage.net',
          'update.centrastage.net',
          'realtime.centrastage.net',
          'ts.centrastage.net'
      )
      and ( 
          InitiatingProcessVersionInfoCompanyName has_any ('CentraStage', 'Datto', 'Kaseya' )
      or isempty(InitiatingProcessVersionInfoCompanyName)
      )
  | summarize FirstSeen=min(Timestamp), LastSeen=max(Timestamp), 
      Report=make_set(ReportId), Count=count() by DeviceId, DeviceName,
      AccountUpn, RemoteUrl 
